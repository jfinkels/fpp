%% fpp.tex - fixed-parameter parallelizability
%%
%% Copyright 2016 Jeffrey Finkelstein.
%%
%% This LaTeX markup document is made available under the terms of the Creative
%% Commons Attribution-ShareAlike 4.0 International License,
%% https://creativecommons.org/licenses/by-sa/4.0/.
\documentclass[draft]{article}

\usepackage{amsmath}
\usepackage{amssymb}
%% This must come before hyperref.
\usepackage{amsthm}
%% This is strongly recommended by biblatex.
\usepackage[english]{babel}
\usepackage[backend=biber]{biblatex}
\usepackage[T1]{fontenc}
%% This must come before csquotes.
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
%% This is strongly recommended by biblatex.
\usepackage{csquotes}
%% This must come before hyperref.
\usepackage{thmtools}
%% This must come before complexity.
\usepackage{hyperref}
\usepackage{complexity}
\usepackage[firstpage]{draftwatermark}
\usepackage[final]{microtype}
\usepackage{textcomp}

%% Set the amount by which certain characters protrude into the margins.
%%
%% \LoadMicrotypeFile{cmr}
%%
%%     This command forces the built-in protrusion settings for the Computer
%%     Modern Roman (cmr) font family to become available at this point, so
%%     that we can override these settings on the next line. Even though we are
%%     really using the Latin Modern Roman (lmr) fonts, microtype uses the cmr
%%     configuration file.
%%
%% \SetProtrusion
%%
%%     This instructs the microtype package that we are going to modify the
%%     protrusion settings.
%%
%% [load=lmr-T1]
%%
%%     Loads the Type 1 (T1) encoding of the lmr font family, thereby setting
%%     the default protrusion values for all the characters. This is only
%%     possible after the \LoadMicrotypeFile{cmr} command (microtype
%%     essentially considers lmr to be an alias for cmr).
%%
%% {encoding=T1, family=lmr}
%%
%%     Indicates that we are going to modify the protrusion values for the T1
%%     encoding of the lmr font family.
%%
%% \textquotedblright = {,1000} (and similar commands)
%%
%%     Force the character given by \textquotedblright to have default
%%     protrusion on the left margin (given by an empty string before the
%%     comma) and full protrusion (that is, protrusion value 1000) on the right
%%     margin.
\LoadMicrotypeFile{cmr}
\SetProtrusion
    [load=lmr-T1]
    {encoding=T1, family=lmr}
    {
      \textquotedblright = {,1000},
      \textquotedblleft = {1000,},
      {'} = {,1000},
      {,} = {,1000},
      {:} = {,1000},
      {;} = {,1000},
      {.} = {,1000}
    }

%% Set the ``work-in-progress'' watermark for the first page.
\SetWatermarkLightness{0.9}
\SetWatermarkText{Work-in-progress}
\SetWatermarkFontSize{3.5cm}

%% Set the title and author of the PDF file.
\hypersetup{pdftitle={Fixed-parameter parallelizability}, pdfauthor={Jeffrey Finkelstein}}

%% Declare the bibliography file.
\addbibresource{fpp.bib}

%% Declare theorem-like environments.
\declaretheorem[numberwithin=section]{theorem}
\declaretheorem[numberlike=theorem]{lemma}
\declaretheorem[numberlike=theorem]{proposition}
\declaretheorem[numberlike=theorem]{assumption}
\declaretheorem[numberlike=theorem, style=definition]{definition}

%% Custom commands are declared here.
\newcommand{\email}[1]{\textlangle\href{mailto:#1}{\nolinkurl{#1}}\textrangle}
\newcommand{\todo}[1]{\textbf{TODO #1}}
\newcommand{\dash}{\textnormal{-}}
\newcommand{\pncsat}{p\dash\log\dash\NC^d\dash\textsc{Circuit Sat}}
\newcommand{\pgrouprank}{p\dash\textsc{Group Rank}}
\newcommand{\gen}[1]{\langle#1\rangle}
\DeclareMathOperator{\depth}{depth}
\DeclareMathOperator{\nondet}{nondet}
\DeclareMathOperator{\size}{size}

%% Redefine the footnote environment so it has no reference and no number.
\long\def\symbolfootnote#1{\begingroup%
\def\thefootnote{\fnsymbol{footnote}}\footnotetext{#1}\endgroup}

%% Define the author, title, and date for the document.
\author{Jeffrey~Finkelstein\\ Computer Science Department, Boston University}
\title{Fixed-parameter parallelizability}

\begin{document}

\maketitle

\symbolfootnote{%
  Copyright 2016 Jeffrey~Finkelstein \email{jeffreyf@bu.edu}.

  This document is licensed under the Creative Commons Attribution-ShareAlike 4.0 International License, which is available at \mbox{\url{https://creativecommons.org/licenses/by-sa/4.0/}}.
  The \LaTeX{} markup that generated this document can be downloaded from its website at \mbox{\url{https://github.com/jfinkels/fpp}}.
  The markup is distributed under the same license.
}

%% Document content goes here.
%
% Global components at each level must follow this structure.
%
% % Foreword %
%
% %% Context (anyone - why now?) %%
%
% What is the current situation, and why is the need so important?
%
%
% %% Need (readers - why you?) %%
%
% Why is this relevant to the reader, and why does something need to be done?
% (Also reference relevant existing work.)
%
%
% %% Task (author - why me?) %%
%
% What was undertaken to address the need?
%
%
% %% Object (document - why this document?) %%
%
% What does this document cover?
%
%
% % Summary %
%
% %% Findings (author - what?)
%
% What did the work reveal when performing the task?
%
%
% %% Conclusion (readers - so what?)
%
% What did the findings mean for the audience?
%
%
% %% Perspective (anyone - what now?)
%
% What should be done next?

\section{Definitions}

\begin{definition}
  A \emph{Boolean circuit}, or simply a \emph{circuit}, $C$, is an directed acyclic graph.
  The \emph{size of a circuit}, denoted $\size(C)$, is the number of vertices in the underlying graph.
  The \emph{depth of a circuit}, denoted $\depth(C)$, is the length of a longest path from the root to a sink.
\end{definition}

\begin{definition}
  A function $f$ is \emph{circuit-computable} if there is a nonuniform family of Boolean circuits $\{C_n\}_{n \in \mathbb{N}}$ such that for each $x$ we have $f(x) = C_n(x)$, where $n = |x|$.

  A language is \emph{circuit-decidable} if it has a circuit-computable characteristic function.
  We may also require that the size and depth of each circuit $C_n$ in the family be circuit-computable from just $n$, the length of the input.
  In this case, we say the language is \emph{circuit-decidable with uniform size and depth}.
\end{definition}

Nonuniformity is required in \autoref{thm:eventually} and \autoref{thm:rmparam}, for example, in which the size of the input relative to the size of the parameter for an instance of the parameterized problem selects which of two circuits to use.
If the circuits were uniform, we would need to include both alternatives, thereby making the circuits too deep to meet the required circuit depth bounds.

\begin{definition}
  A \emph{language} is a set of binary strings.
  A \emph{parameterization} is a computable function $\kappa$ from binary strings to natural numbers.
  A \emph{parameterized problem} is a pair $(Q, \kappa)$, where $Q$ is a language and $\kappa$ is a parameterization.
\end{definition}

\begin{definition}[$\NNC^d$ and $\NC^d$]
  Let $d$ be a natural number.
  A language $Q$ is in the class $\NNC^d[b(n)]$ if there is a nondeterministic circuit family $\{C_n\}$ such that for each string $x$ of length $n$,
  \begin{itemize}
  \item $x \in Q$ if and only if $C_n(x) = 1$,
  \item $\size(C_n) \leq n^{O(1)}$,
  \item $\depth(C_n) \leq O(\log^d n)$,
  \item $\nondet(C_n) \leq b(n)$.
  \end{itemize}
  If $b$ is the zero function, then the language is in the class $\NC^d$.
\end{definition}

\begin{definition}[{$\WP^d[P]$ and $\FPP^d$}]
  Let $d$ be a natural number.
  A parameterized problem $(Q, \kappa)$ is in the class $\WP[P]^d$ if there are circuit-computable functions $f$, $g$, and $h$, and a nondeterministic circuit family $\{C_{n, k}\}$ such that for each string $x$,
  \begin{itemize}
  \item $x \in Q$ if and only if $C_{n, k}(x) = 1$, where $n = |x|$ and $k = \kappa(x)$,
  \item $\size(C_{n, k}) \leq f(k) n^{O(1)}$,
  \item $\depth(C_{n, k}) \leq g(k) \log^d n$,
  \item $\nondet(C_{n, k}) \leq h(k) \log n$.
  \end{itemize}
  If $h$ is the zero function, then the parameterized problem is in the class $\FPP^d$.
\end{definition}

\begin{definition}
  Suppose $d$ is a natural number and $(Q, \kappa)$ is a parameterized problem.
  We say the problem $(Q, \kappa)$ is \emph{eventually in $\NC^d$} if there is a circuit-computable function $h$ and a $\NC^d$ family of circuits $\{C_n\}_{n \in \mathbb{N}}$ such that for each $x$ of length $n$, if $n \geq h(\kappa(x))$, then $x \in Q$ if and only if $C_n(x) = 1$.
\end{definition}

Throughout we will often assume without loss of generality that functions like circuit size and depth bounds, nondeterministism bounds, and polynomials, are increasing

\section{Fixed-parameter parallelizability}

\subsection{Example problem in FPP}

The parameterized vertex cover problem is in $\FPP$ \autocite{bst15}, but the underlying decision problem is $\NP$-complete.
We are interested in finding a problem in $\FPP$ whose underlying decision problem is $\P$-complete.
One way to do this is to find an optimization problem whose budget problem is $\P$-complete while admitting a highly parallel approximation scheme via a ``fixed-parameter parallelizable'' algorithm.

\begin{definition}
  An \emph{optimization problem} $O$ is a four-tuple $(I, S, m, t)$, where $I$ is the set of instances, $S$ is the set of pairs $(x, w)$ where $w$ is a solution for $x$, the function $m$ computes the \emph{measure} (or \emph{objective value}) for such a pair, and $t$ is either $\min$ or $\max$.
\end{definition}

\begin{definition}
  The \emph{standard parameterization} of a minimization problem $O$, denoted $p\dash{O}$, is $(Q, \kappa)$, where $Q = \{ (x, k) \, | \, m^*(x) \geq k \}$ and $\kappa(x, k) = k$.
  The inequality is reversed for a maximization problem.
\end{definition}

\begin{definition}
  Suppose $(I, S, m, t)$ is an optimization problem and $(x, y) \in S$.
  The \emph{performance ratio} of the solution $y$ (with respect to $x$), denoted $R(x, y)$, is defined by
  \[
  R(x, y) = \max \left(\frac{m(x, y)}{m^*(x)}, \frac{m^*(x)}{m(x, y)}\right)
  \]
\end{definition}

The performance ratio $R(x, y)$ is a number in the interval $[1, \infty)$.
The closer $R(x, y)$ is to 1, the better the solution $y$ is for $x$, and the closer $R(x, y)$ to $\infty$, the worse the solution.

\begin{definition}
  An \emph{approximation scheme} for an optimization problem is a function $A$ such that for all $x$ and all positive integers $k$ we have $(x, A(x, k)) \in S$ and $R(x, A(x, k)) \leq 1 + \frac{1}{k}$.
\end{definition}

An approximation scheme induces a family of functions, $\{A_k\}_{k \in \mathbb{N}}$, that form progressively better approximations for the optimization problem.

%% \begin{definition}
%%   An optimization problem $O$ has an \emph{$\NC$ approximation scheme} if there is an approximation scheme $A$ for $O$ such that for each $k$, we have $A_k \in \FNC$, where $A_k(x) = A(x, k)$ for each $x$.
%% \end{definition}

\begin{definition}
  Suppose $O$ is an optimization problem with $O = (I, S, m, t)$ with $I$ and $S$ in $\NC$ and $m$ in $\FNC$.
  An optimization problem $O$ is in $\NCAS$ if there is an approximation scheme $A$ for $O$ such that for each $k$, we have $A_k \in \FNC$, where $A_k(x) = A(x, k)$ for each $x$.
  The problem is in $\FNCAS$ if there is an approximation scheme $A$ for $O$ such that $A \in \FNC$ (i.e. on both inputs).
\end{definition}

This definition is adapted from \autocite[Definition~1.31]{fg06}

\begin{definition}
  An optimization problem $O$ is in $\ENCAS$ if there is a circuit family $\{A_{n, k}\}$ and circuit-computable functions $f$ and $g$ such that
  \begin{itemize}
  \item $\{A_{n, k}\}$ is an approximation scheme for $O$,
  \item $\size(A_{n, k}) \leq f(k) n^{O(1)}$,
  \item $\depth(A_{n, k}) \leq g(k) \log^{O(1)} n$.
  \end{itemize}
\end{definition}

\begin{proposition}\label{prop:encas}
  $\FNCAS \subseteq \ENCAS \subseteq \NCAS$.
\end{proposition}

\begin{theorem}\label{thm:encasfpp}
  If $O$ is in $\ENCAS$, then $p\dash{O}$ is in $\FPP$.
\end{theorem}
\begin{proof}
  Assume without loss of generality that $O$ is a minimization problem; the proof is similar if it is a maximization problem.
  Let $\{m_n\}$ be the $\NC$ circuit family that computes the measure function.
  Let $\{A_{n, k}\}$ be the circuit family such that
  \begin{itemize}
  \item $R(x, A_{n, k}(x, k)) \leq 1 + \frac{1}{k}$ for each $x$ and $k$,
  \item $\size(A_{n, k}) \leq f(k) n^{O(1)}$,
  \item $\depth(A_{n, k}) \leq g(k) \log^{O(1)} n$,
  \end{itemize}
  for some circuit-computable functions $f$ and $g$.
  Define the circuit family $\{C_{n, k}\}$ as
  \[
  C_{n, k}(x, k) = 1 \iff m(x, A_{n, k + 1}(x, k + 1)) \leq k,
  \]
  so $C_{n, k}$ outputs 1 if and only if the approximate solution corresponding to parameter $k + 1$ measures less than $k + 1$.
  (The function $m$ is really a circuit as well, chosen from a family of circuits depending on the number of bits in its inputs.)

  The size of $C_{n, k}$ is $O(\size(m) + \size(A_{n, k + 1}))$, which is $f'(k)n^{O(1)}$ for some circuit-computable function $f'$.
  The depth is $O(\depth(m) + \depth(A_{n, k + 1})$, which is $g'(k + 1) \log^{O(1)} n$ for some circuit-computable function $g'$.
  It remains to show correctness of $C_{n, k}$.

  Let $x$ be a string, let $k$ be a natural number, and let $y = A_{n, k + 1}(x, k + 1)$.
  If $C_{n, k} = 1$, then $m(x, y) \leq k$, so $m^*(k) \leq k$ and therefore $(x, k) \in p \dash O$.
  For the converse, if $C_{n, k} = 0$, then $m(x, y) \geq k + 1$, so
  \[
  m^*(x) \geq \frac{m(x, y)}{1 + \frac{1}{k + 1}} \geq \frac{k + 1}{1 + \frac{1}{k + 1}} = \frac{(k + 1)^2}{k + 2} > k.
  \]
  Thus $(x, k) \notin p \dash O$.
  Therefore, we conclude that $p \dash O$ is in $\FPP$.
\end{proof}

The converse does not hold; the minimum vertex cover problem is in example.
\todo{Show an example for an optimization problem whose budget problem is $\P$-complete.}

Our goal now reduces to finding an optimization problem in $\ENCAS$ whose budget problem is $\P$-complete.
%% There exist problems that are $\P$-complete and have randomized $\FNCAS$ algorithms, so under a derandomization assumption, we can show a problem that fits the requirement.

\begin{definition}[\textsc{Maximum Flow}]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & directed graph $G$, a natural number capacity $c_e$ for each edge $e$, source node $s$, and target node $t$. \\
    \textbf{Solution:} & flow $F$, defined as a real number $F_e$ for each edge $e$ such that $F_e \leq c_e$ and at each vertex the total in-flow is at least the total out-flow. \\
    \textbf{Measure:} & total in-flow at $t$. \\
    \textbf{Type:} & maximization.
  \end{tabular}
\end{definition}

%% edge flows can have weights exponential in n

\begin{theorem}
  If $\NC = \RNC$, then the budget problem for \textsc{Maximum Flow} is $\P$-complete and the standard parameterization is in $\FPP$.
\end{theorem}
\begin{proof}
  The budget problem for \textsc{Maximum Flow} is $\P$-complete \autocite[Problem~A.4.4]{ghr95}.
  The \textsc{Maximum Flow} problem is in randomized $\FNCAS$ \autocite[Theorem~4.5.2]{dsst97}.
  \todo{Double check this.}
  If $\NC = \RNC$, then randomized $\FNCAS$ equals deterministic $\FNCAS$.
  Thus, the problem is in $\ENCAS$, by \autoref{prop:encas}.
  Finally, the standard parameterization is in $\FPP$ by \autoref{thm:encasfpp}.
\end{proof}

\todo{Can the randomization part of the RNC algorithm for MaxFlow be absorbed in the fixed-parameter part of the algorithm?}

\todo{Can we do this without requiring a FNCAS?}

% The positive linear programming problem is only in NCAS, not FNCAS.

\section{\texorpdfstring{$\FPP$ is to $\NC$ as $\WP$ is to $\NNC$}{FPP is to NC as WP is to NNC}}
%\section{Limited nondeterminism versus fixed-parameter parallelizability}

\subsection{Does FPP = WP[P]?}

This theorem is a characterization of parameterized problems in the class $\FPP^d$ as problems for which the parameter suggests an input size threshold, below which it suffices to perform an exhaustive search to solve the problem and after which we require an efficient algorithm.
It is the adaptation of \autocite[Theorem~1.37]{fg06}.

\begin{theorem}\label{thm:eventually}
  Suppose $d$ is a natural number and $(Q, \kappa)$ is a parameterized problem.
  If $Q$ is circuit-decidable with uniform size and depth and $(Q, \kappa)$ is eventually in $\NC^d$, then $(Q, \kappa)$ is in $\FPP^d$.
\end{theorem}
\begin{proof}
  Let $h$ be the function that defines the lower bound on the length after which $(Q, \kappa)$ is in $\NC^d$.
  The nonuniform family of circuits $\{A_{n, k}\}$ that decides $(Q, \kappa)$ is defined by
  \[
  A_{n, k} =
  \begin{cases}
    C^1_n & \text{if } n < h(k) \\
    C^2_n & otherwise,
  \end{cases}
  \]
  where $\{C^1_n\}$ is the family of circuits that decides $Q$ and $\{C^2_n\}$ is the family of $\NC^d$ circuits that eventually decides $(Q, \kappa)$.
  The correctness of $A_{n, k}$ follows from the correctness of $C^1_n$ and $C^2_n$.

  Let $S$ and $D$ be the circuit-computable function that give the size and depth, respectively, of $C^1_n$ from $n$.
  If $n < h(k)$, then
  \begin{align*}
    \size(A_{n, k}) & = \size(C^1_n) = S(n) \leq S(h(k)), \\
    \depth(A_{n, k}) & = \depth(C^1_n) = D(n) \leq D(h(k)).
  \end{align*}
  If $n \geq h(k)$, then
  \begin{align*}
    \size(A_{n, k}) & = \size(C^2_n) = n^{O(1)}, \\
    \depth(A_{n, k}) & = \depth(C^2_n) = O(\log^d n).
  \end{align*}
  An upper bound for the size of $A_{n, k}$ in either case is $S(h(k)) n^{O(1)}$ and for the depth $O(D(h(k)) \log^d n)$.
  Since $S$ and $D$ are computable, composing each with $h$ yields another computable function, so these size and depth bounds meet the requirements of the definition of $\FPP^d$.
\end{proof}

The next theorem is similar in that it is a characterization of $\WP^d[P]$, a nondeterministic extension of $\FPP^d$.
It is the adaptation of \autocite[Proposition~3.7]{fg06}.
The parameterized problems in $\WP^d[P]$ of most interest to us are those for which there is a nondeterministic $\NC$ algorithm with nondeterminism limited by a function of the parameter.

\todo{
  There's some wiggle room with this theorem: if we change the definition of $\WP^d[P]$ to have depth $g(k) + \log^d n$, then we can get $\NNC^d$ instead of $\NNC^{d + e}$ in the conclusion.
  This sort of depth bound appears in \autocite{bst15}.
}

\begin{theorem}\label{thm:rmparam}
  Suppose $d$ is a natural number, $e$ is a positive integer, and $(Q, \kappa)$ is a parameterized problem.
  %% If e = 0, then we get a divide-by-zero error.
  If $(Q, \kappa) \in \WP^d[P]$ and $Q \in \NNC^d[\poly]$, then there is a nondeterministic $\NC^{d + e}$ circuit family $\{C_{n, k}\}$ and a circuit-computable function $h$ such that $\{C_{n, k}\}$ decides $Q$ and $\nondet(C_{n, k}) \leq h(k) \log n$.
  %% The converse holds when $e = 0$.
\end{theorem}
\begin{proof}
  Assume $(Q, \kappa) \in \WP^d[P]$ and $Q \in \NNC^d[\poly]$.
  Define the circuit family $\{A_{n, k}\}$ by
  \[
  A_{n, k} =
  \begin{cases}
    C^1_{n, k} & \text{if } f_1(k) \leq n \text{ and } g_1(k) \leq \log^e n \\
    C^2_n & \text{otherwise},
  \end{cases}
  \]
  where
  \begin{itemize}
  \item $\{C^1_{n, k}\}$ is the $\WP^d[P]$ circuit family,
  \item $f_1$ and $g_1$ are the circuit-computable functions on the parameter that appear in the size and depth bounds, respectively, for $C^1_{n, k}$,
  \item $\{C^2_n\}$ is the $\NNC^d[\poly]$ circuit family.
  \end{itemize}
  The fact that $A_{n, k}$ correctly decides $Q$ follows from the correctness of the circuits $C^1_{n, k}$ and $C^2_n$.
  It remains to show that $A_{n, k}$ has the required size, depth, and nondeterminism bounds.

  If $f_1(k) \leq n$ and $g_1(k) \leq \log^e n$, then
  \begin{align*}
    \size(A_{n, k}) & \leq \size(C^1_{n, k}) \leq f_1(k) n^{O(1)} \leq n^{O(1)} \\
    \depth(A_{n, k}) & \leq \depth(C^1_{n, k}) \leq g_1(k) \log^d n \leq \log^{d + e} n,
  \end{align*}
  and otherwise
  \begin{align*}
    \size(A_{n, k}) & \leq \size(C^2_n) \leq n^{O(1)} \\
    \depth(A_{n, k}) & \leq \depth(C^2_n) \leq \log^d n.
  \end{align*}
  The overall size and depth upper bounds for $A_{n, k}$ are thus $n^{O(1)}$ and $O(\log^{d + e} n)$, respectively.

  For the nondeterminism, there are three cases.
  First, if $f_1(k) \leq n$ and $g_1(k) \leq \log^e n$, then
  \[
  \nondet(A_{n, k}) \leq \nondet(C^1_{n, k}) \leq h_1(k) \log n,
  \]
  where $h_1$ is the circuit-computable of the parameter that appears in the nondeterminism bound for $C^1_{n, k}$.
  Second, if $f_1(k) > n$, then
  \[
  \nondet(A_{n, k}) \leq \nondet(C^2_n) \leq n^{O(1)} \leq f_1(k)^{O(1)}.
  \]
  Finally, if $g_1(k) > \log^e n$, then $2^{(g_1(k))^{1 / e}} > n$, which implies
  \[
  \nondet(A_{n, k}) \leq \nondet(C^2_n) \leq n^{O(1)} \leq 2^{O((g_1(k))^{1 / e})}.
  \]
  If we choose $h(k) = \max\{ h_1(k), f_1(k)^{O(1)}, 2^{O((g_1(k))^{1 / e})} \}$, then we can conclude $\nondet(A_{n, k}) \leq h(k) \log n$.
\end{proof}

\begin{assumption}\label{ass:complete}
  There is a parameterized problem $(Q, \kappa)$ complete for $\WP^d[\P]$ under $\FPP^d$ many-one reductions such that $Q \in \NNC^d[\poly]$.
\end{assumption}

This theorem is an adaptation of one direction of \autocite[Theorem~3.29]{fg06}.

\begin{theorem}[Theorem~3.29, part i]
  Assume \autoref{ass:complete}.
  Suppose $d$ is a natural number and $e$ is a positive integer.
  If there is a circuit-computable, nondecreasing, unbounded function $i$ such that $\NC^d = \NNC^{d + e}[i(n) \log n]$, then $\FPP^d = \WP^d[P]$.
  \todo{Does $i$ need to be computable here?}
\end{theorem}
\begin{proof}
  Assume $\NC^d = \NNC^{d + e}[i(n) \log n]$.
  By \autoref{ass:complete}, let $(Q, \kappa)$ be a parameterized problem complete for $\WP^d[P]$ with $Q \in \NNC^d[\poly]$.
  By \autoref{thm:rmparam}, there is a circuit-computable function $h$ and an $\NNC^{d + e}$ circuit family $\{C_{n, k}\}$ such that $\nondet(C_{n, k}) \leq h(k) \log n$.

  Let $f$ be a circuit-computable function such that $n \geq f(k)$ implies $h(k) \leq i(n)$.
  \todo{Explain why such an $f$ must exist.}
  Now consider the set $Q^+$, defined by
  \[
  Q^+ = Q \cap \left\{ x \, \middle| \, |x| \geq f(\kappa(x)) \right\}.
  \]
  Since $|x| \geq f(\kappa(x))$ for each $x \in Q^+$, we have $h(\kappa(x)) \leq i(|x|)$.
  Thus $Q^+$ is in $\NNC^{d + e}[i(n) \log n]$.
  By assumption, $Q^+$ is therefore also in $\NC^d$.
  This means $Q$ is eventually in $\NC^d$, so we have $Q \in \FPP^d$ by \autoref{thm:eventually}.
\end{proof}

This lemma is an adaptation of \autocite[Lemma~3.24]{fg06}.

\begin{lemma}\label{lem:i}
  Suppose $e$ is a positive integer and $f$ and $g$ are increasing, circuit-computable functions.
  %% If e is 0, then i_{g, e} is not unbounded.
  There are functions $i_f$ and $i_{g, e}$ such that
  \begin{itemize}
  \item $f(i_f(n)) \leq n$ for each $n \geq f(1)$,
  \item $g(i_{g, e}(n)) \leq \log^e n$ for each $n \geq g(1)$.
  \end{itemize}
  Furthermore, these functions are circuit-computable, nondecreasing, unbounded.
\end{lemma}
\begin{proof}
  Define $i_f$ by
  \[
  i_f(n) = \begin{cases}
    \max\{ j \in \mathbb{N} \, | \, f(j) \leq n\} & \text{if } n \geq f(1) \\
    1 & \text{otherwise},
  \end{cases}
  \]
  and $i_{g, e}$ by
  \[
  i_{g, e}(n) = \begin{cases}
    \max\{ j \in \mathbb{N} \, | \, g(j) \leq \log^e n\} & \text{if } n \geq g(1) \\
    1 & \text{otherwise}.
  \end{cases}
  \]
  It is straightforward to prove that these functions are nondecreasing and unbounded.
  To compute $i_f$ (computing $i_{g, e}$ is similar), we compute $f(1), \dotsc, f(n)$ in parallel, filter by only those values that are at most $n$, and choosing the index of the rightmost value that passes the filter.
\end{proof}

This is the $\NC^d$ bounded version of the parameterized problem from \autocite[Lemma~3.26]{fg06}.

\begin{definition}[$\pncsat$]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & Boolean circuit $C$ of on $n$ inputs, with size $m$ and depth $O(\log^d n)$. \\
    \textbf{Parameter:} & $n / \log m$. \\
    \textbf{Question:} & Is $C$ satisfiable?
  \end{tabular}
\end{definition}

\begin{lemma}
  $\pncsat$ is in $\WP^d[P]$.
\end{lemma}
\begin{proof}
  The depth-universal circuit $U$ of \autocite{ch85} proves membership of this problem in $\WP^d[P]$.
  The number of nondeterministic bits required by the universal circuit is simply $n$, the size of the input to the circuit $C$, which is of the form $h(k) \log m$ if we choose $h(k) = k = n / \log m$ where $k = \kappa(x)$.
\end{proof}

\todo{
  Ideally, it should be complete for it too (this would prove the assumption above), but the problem comes in the reduction from an arbitrary paramterized problem to this one: the circuit depth needs to be polylogarithmic, but it may be larger.
  Perhaps we can use the other complete problems from \autocite{cc97} here?
}

This is an adaptation of the other direction of \autocite[Theorem~3.29]{fg06}.

\begin{theorem}
  Suppose $e$ is a positive integer.
  If $\FPP^d = \WP^d[P]$, then there is a circuit-computable, nondecreasing, unbounded function $i$ such that $\NC^{d + e} = \NNC^d[i(n) \log n]$.
\end{theorem}
\begin{proof}
  Assume $\FPP^d = \WP^d[P]$.
  Since $\pncsat$ is in $\WP^d[P]$, it is now in $\FPP^d$ as well.
  Thus there is a deterministic circuit family $\{C_{m, k'}\}$ and circuit-computable functions $f$ and $g$ such that
  \begin{itemize}
  \item for each instance $D$, we have $D \in \NC^d\textnormal{-}\textsc{Circuit Sat}$ if and only if $C_{m, k'}(D) = 1$,
  \item $\size(C_{m, k'}) \leq f(k') m^{O(1)}$,
  \item $\depth(C_{m, k'}) \leq g(k') \log^d m$.
  \end{itemize}
  Assume without loss of generality that $f$ and $g$ are increasing.
  Let $i_f$ and $i_{g, e}$ be the functions corresponding to $f$ and $g$, respectively, guaranteed by \autoref{lem:i}.
  Let $i(n) = \min(i_f(n), i_{g, e}(n))$, for each natural number $n$.

  Let $Q \in \NNC^d[i(n) \log n]$
  Suppose $\{D_n\}$ is the family of $\NNC^d[i(n) \log n]$ circuits that decides $Q$.
  For each input $x$, let $D_x$ denote $D_n$ with $x$ hardcoded.

  Let $R_n$ be the circuit-computable function $x \mapsto D_x$, where $n$ denotes the length of $x$.
  Then
  \begin{itemize}
  \item for each $x$, we have $x \in Q$ if and only if $D_x$ is satisfiable,
  \item $\size(R_n) \leq O(\size(D_x)) = O(\size(D_n)) = n^{O(1)}$,
  \item $\depth(R_n) \leq O(1)$.
  \end{itemize}
  If $\kappa$ denotes the parameter function for $\pncsat$, we can now define the family $\{A_n\}$ as $A_n = C_{m, k'} \circ R_n$, where
  \[
  m = |R_n(x)| = O(\size(R_n)) = n^{O(1)},
  \]
  and
  \[
  k' = \kappa(R_n(x)).
  \]
  We claim that $\{A_n\}$ is the $\NC^{d + e}$ circuit family that decides $Q$.

  The correctness of $A_n$ follows from the correctness of both $R_n$ and $C_{m, k'}$.
  The size of $R_n$ is $n^{O(1)}$ and the size of $C_{m, k'}$ is $f(k') m^{O(1)}$.
  Assuming $n \leq m \leq n^{O(1)}$,
  \begin{align*}
    \size(A_n) & = n^{O(1)} + f(k') m^{O(1)} \\
    & \leq f(k') n^{O(1)} \\
    & = f\left(\frac{i(n) \log n}{\log m}\right) n^{O(1)} \\
    & \leq f\left(\frac{i_f(n) \log n}{\log n}\right) n^{O(1)} \\
    & \leq f(i_f(n)) n^{O(1)} \\
    & \leq n^{O(1)}.
  \end{align*}
  The depth of $R_n$ is $O(1)$ and the depth of $C_{m, k'}$ is $g(k') \log^d m$.
  Thus,
  \begin{align*}
    \depth(A_n) & = O(1) + g(k') \log^d m \\
    & \leq O(g(k') \log^d n) \\
    & = O(g\left(\frac{i(n) \log n}{\log m}\right) \log^d n) \\
    & \leq O(g\left(\frac{i_{g, e}(n) \log n}{\log n}\right) \log^d n) \\
    & \leq O(g(i_{g, e}(n)) \log^d n) \\
    & \leq O((\log^e n)(\log^d n)) \\
    & \leq O(\log^{d + e} n).
  \end{align*}

  We have shown that $\{A_n\}$ is a $\NC^{d + e}$ circuit family that decides $Q$, thus $Q \in \NC^{d + e}$.
  Since $Q$ was an arbitrary element of $\NNC^d[i(n) \log n]$, we conclude that $\NC^{d + e} = \NNC^d[i(n) \log n]$.
\end{proof}

\subsection{Does WP[P] = W[P]?}

\todo{I think yes, since NNC = NP; prove it.}

\section{\texorpdfstring{The $\WP$ hierarchy}{The WP hierarchy}}

\subsection{Example problem in the hierarchy}

For the necessary background in logic, see \autocite[Chapter~4]{fg06}.

\begin{definition}[$\textsc{Group Rank}$]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & finite group $G$ given as a product table, positive integer $k$. \\
    \textbf{Question:} & Does $G$ have a generating set of cardinality $k$?
  \end{tabular}
\end{definition}

Let $\pgrouprank$ denote the standard parameterization of $\textsc{Group Rank}$.

\begin{theorem}
  $\pgrouprank$ is in $\WP^1[P]$.
\end{theorem}
\begin{proof}
  The (unparameterized) language $\textsc{Group Rank}$ is in $\beta_2 \FOLL$ \autocite[Theorem~4.2]{grouprank}.
  The algorithm nondeterministically chooses a set of $k$ group elements, each requiring $O(\log n)$ bits to represent, then (deterministically) verifies that the set generates the entire group.
  Thus there is a nondeterministic circuit family that decides $\textsc{Group Rank}$ with (parameter-less) size and depth bounds of $n^{O(1)}$ and $\log \log n$, respectively, and using $O(k) \log n$ nondeterministic bits.
  Therefore the parameterized problem is in $\WP^1[P]$.
\end{proof}

Is this problem in a fixed finite level of the $\WP$ hierarchy?
Let us try to express this problem in first-order logic.

\begin{definition}[Axiomatization of groups]
The signature for groups has a constant symbol for the identity element denoted $e$, a unary function for the inverse denoted $x^{-1}$, and a binary function for the group operation.
Let the group axioms be defined as first-order formulae as follows.
\begin{align*}
  \textsc{HasIdentity} & = \forall x\, (ex = x \land xe = x) \\
  \textsc{HasInverses} & = \forall x\, (x^{-1} x = x x^{-1} = e) \\
  \textsc{IsAssociative} & = \forall x \forall y \forall z\, ((x y) z = x (y z))
\end{align*}
Let $\textsc{IsGroup}$ be the conjunction of these three formulae.
Now for any finite structure $\mathcal{A}$, we have $\mathcal{A} \models \textsc{IsGroup}$ if and only if $\mathcal{A}$ is a group.
Let $\textsc{Group}$ denote the class of all finite structures that are valid groups, that is, the class of all structures that model $\textsc{IsGroup}$.
\end{definition}

Since the universal quantifiers can be placed in the beginning of the formula, $\textsc{IsGroup}$ is in $\Pi_1$.

Let $\textsc{IsMember}(g, X)$ denote the formula for which $\mathcal{G} \models \textsc{IsMember}(g, X)$ exactly when $g \in \gen{S}_\mathcal{G}$.
In \autocite[Subsection~3.3]{bklm01} the authors fail to show that this formula is in $\FO[\log \log n]$, but we do know that the problem of deciding whether $\mathcal{G} \models \textsc{IsMember}(g, X)$, given a group $\mathcal{G}$, a subset $S$ of $\mathcal{G}$, and a group element $g$, is in $\L$ \autocite[Lemma~3.5]{grouprank}.
Since $\L = \FO(\DTC)$, our best upper bound for the definability of $\textsc{IsMember}$ is $\FO(\DTC)$.

Let $\Phi$ be a class of formulas and let $\phi$ be an element of $\Phi$ with one free relation variable $X$ of arity $s$.
Define the model checking problem and the weighted definability problems as follows.

\begin{definition}[{$\MC(\Phi)$ \autocite[Section~4.3]{fg06}}]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & structure $\mathcal{A}$, formula $\phi \in \Phi$. \\
    \textbf{Question:} & Does $\mathcal{A} \models \phi$?
  \end{tabular}
\end{definition}

\begin{definition}[{$\WD_\phi$ \autocite[Section~4.3]{fg06}}]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & structure $\mathcal{A}$, natural number $k$. \\
    \textbf{Question:} & Is there an $S \subseteq A^s$ such that $|S| = k$ and $\mathcal{A} \models \phi(S)$?
  \end{tabular}
\end{definition}

In this setting, $\textsc{Group Rank}$ is $\WD_\phi$, where
\[
\phi(X) = \textsc{IsGroup} \land \forall g\, (\textsc{IsMember}(g, X)).
\]
Similarly, $\textsc{Group Rank}$ reduces to $\MC(\FO(\DTC))$ via the reduction $(\mathcal{G}, k) \mapsto (\mathcal{G}, \textsc{IsGenerating}_k)$, where
\[
\textsc{IsGenerating}_k = \textsc{IsGroup} \land \exists x_1 \dotsb \exists x_k\, (\textsc{IsMember}_k(g, x_1, \dotsc, x_k)),
\]
and
\[
\textsc{IsMember}_k(g, x_1, \dotsc, x_k) \equiv \textsc{IsMember}(g, \{x_1, \dotsc, x_k\}).
\]

Now consider the parameterized version of the model checking and weighted definability problems.

\begin{definition}[{$p\textnormal{-}\MC(\Phi)$ \autocite[Section~5.2]{fg06}}]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & structure $\mathcal{A}$, formula $\phi \in \Phi$. \\
    \textbf{Parameter:} & $|\phi|$ \\
    \textbf{Question:} & Does $\mathcal{A} \models \phi$?
  \end{tabular}
\end{definition}

\begin{definition}[{$p\textnormal{-}\WD_\phi$ \autocite[Section~5.1]{fg06}}]
  \mbox{} \\
  \begin{tabular}{r p{9.2cm}}
    \textbf{Instance:} & structure $\mathcal{A}$, natural number $k$. \\
    \textbf{Parameter:} & $k$ \\
    \textbf{Question:} & Is there an $S \subseteq A^s$ such that $|S| = k$ and $\mathcal{A} \models \phi(S)$?
  \end{tabular}
\end{definition}

In the parameterized setting, $\pgrouprank$ is $p\textnormal{-}\WD_\phi$ and is reducible to $p\textnormal{-}\MC(\FO(\DTC))$ via the reductions given above.

\subsection{Definition of finite levels of the hierarchy}

Let $\Phi$ be a class of first-order formulas.
Let $p\textnormal{-}\WD(\Phi)$ be the class of all parameterized problems $p\textnormal{-}\WD_\phi$ for each $\phi \in \Phi$.

This definition is adapted from \autocite[Definition~5.1]{fg06}.

\begin{definition}
  For each natural number $d$ and positive integer $t$, let $WP^d[t] = []$...
\end{definition}

\subsection{Does WP[t] = W[t]?}

\todo{I think no, unless P = NC; prove it.}

\subsection{WP[1] probably does not equal FPP}

\todo{fill me in }

%% Print the bibliography section here.
\printbibliography

\end{document}
